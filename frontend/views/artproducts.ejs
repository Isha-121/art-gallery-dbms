<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Art Products</title>
    <link rel="stylesheet" href="/css/generals.css" />
</head>

<body>
    <%- include("./partials/Navbar.ejs") %>

        <button type="button" class="btn btn-dark btn-insert-modal position-fixed" data-bs-toggle="modal"
            data-bs-target="#insertModal" data-bs-title="Create new user" style="right: 2em; bottom: 2em">
            <i class="fa-solid fa-plus btn-insert-modal"></i>
        </button>
        <form action="/artproducts" method="post">

            <!-- Modal to create user -->
            <div class="modal fade" id="insertModal" tabindex="-1" aria-labelledby="insertModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content p-5">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="insertModalLabel">
                                Insert Art Products
                            </h1><br>
                            <h4 class="lead text-danger">Please enter unique art product it</h4>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="mb-3">
                            <label for="art_id-in" class="form-label">Art id</label>
                            <input type="text" class="form-control" id="art_id-in" value="" name="art_id" required
                                placeholder="Art ID" />
                        </div>
                        <div class="mb-3">
                            <label for="artist_id-in" class="form-label">Artist ID</label>
                            <input type="text" class="form-control" id="artist_id-in" value="" name="artist_id" required
                                placeholder="Artist Id" />
                        </div>
                        <div class="mb-3">
                            <label for="sub_category-in" class="form-label">Sub Category</label>
                            <input type="text" class="form-control" id="sub_category-in" value="" name="sub_category"
                                required placeholder="Sub Category" />
                        </div>
                        <div class="mb-3">
                            <label for="base_price-in" class="form-label">Base Price</label>
                            <input type="text" class="form-control" id="base_price-in" value="" name="base_price"
                                required placeholder="Base Price" />
                        </div>
                        <div class="mb-3">
                            <label for="total_views-in" class="form-label">Total Views</label>
                            <input type="text" class="form-control" id="total_views-in" value="" name="total_views"
                                required placeholder="Total Views" />
                        </div>
                        <div class="mb-3">
                            <label for="likes-in" class="form-label">Likes</label>
                            <input type="text" class="form-control" id="likes-in" value="" name="likes" required
                                placeholder="Likes" />
                        </div>
                        <div class="mb-3">
                            <label for="dislikes-in" class="form-label">Dislikes</label>
                            <input type="text" class="form-control" id="dislikes-in" value="" name="dislikes" required
                                placeholder="Dislikes" />
                        </div>

                        <button type="submit" class="btn btn-success insert-submit-btn">
                            Submit
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Modal to edit user -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content p-5">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="insertModalLabel">
                            Edit Art Product
                        </h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="mb-3">
                        <label for="art_id" class="form-label">Art id</label>
                        <input type="text" class="form-control" id="art_id" value="" name="art_id" required disabled
                            placeholder="Art ID" />
                    </div>
                    <div class="mb-3">
                        <label for="artist_id" class="form-label">Artist ID</label>
                        <input type="text" class="form-control" id="artist_id" value="" name="artist_id" required
                            disabled placeholder="Artist Id" />
                    </div>
                    <div class="mb-3">
                        <label for="sub_category" class="form-label">Sub Category</label>
                        <input type="text" class="form-control" id="sub_category" value="" name="sub_category" required
                            placeholder="Sub Category" />
                    </div>
                    <div class="mb-3">
                        <label for="base_price" class="form-label">Base Price</label>
                        <input type="text" class="form-control" id="base_price" value="" name="base_price" required
                            placeholder="Base Price" />
                    </div>
                    <div class="mb-3">
                        <label for="total_views" class="form-label">Total Views</label>
                        <input type="text" class="form-control" id="total_views" value="" name="total_views" required
                            placeholder="Total Views" />
                    </div>
                    <div class="mb-3">
                        <label for="likes" class="form-label">Likes</label>
                        <input type="text" class="form-control" id="likes" value="" name="likes" required
                            placeholder="Likes" />
                    </div>
                    <div class="mb-3">
                        <label for="dislikes" class="form-label">Dislikes</label>
                        <input type="text" class="form-control" id="dislikes" value="" name="dislikes" required
                            placeholder="Dislikes" />
                    </div>
                    <button type="submit" class="btn btn-success submit-btn">
                        Submit
                    </button>
                </div>
            </div>
        </div>

        <div class="container-fluid w-75 my-5">
            <table class="table">
                <thead class="bg-light">
                    <tr>
                        <th scope="col">Art ID</th>
                        <th scope="col">Artist ID</th>
                        <th scope="col">Sub Category</th>
                        <th scope="col">Base Price</th>
                        <th scope="col">Total Views</th>
                        <th scope="col">Likes</th>
                        <th scope="col">Dislikes</th>
                        <th scope="col">Edit Art</th>
                        <th scope="col">Delete Art</th>
                    </tr>
                </thead>
            </table>
        </div>
</body>

<script>
    var data = <%- JSON.stringify(data) %>;

    console.log(data.rows[0]);
    var table = ``;
    data.rows.forEach(row => {
        table +=
            `<tr>
          <th scope="col">${row.art_id}</th>
          <td scope="col">${row.artist_id}</td>
          <td scope="col">${row.sub_category}</td>
          <td scope="col">${row.base_price}</td>
          <td scope="col">${row.total_views}</td>
          <td scope="col">${row.likes}</td>
          <td scope="col">${row.dislikes}</td>
          <td scope="col"><button type="button" data-art=${row.art_id} class="btn btn-dark btn-modal" data-bs-toggle="modal" data-bs-target="#editModal">
              <i data-art=${row.art_id} class="fa-solid fa-pen-to-square btn-modal"></i>
          </button>
          </td>
          <td scope="col">
             <i role="button" data-art=${row.art_id} class="fa-solid fa-trash text-danger btn-delete p-2" ></i>
          </td>
        </tr>`
    });


    document.querySelector('.table').innerHTML += table;
    var response = {};
    document.querySelectorAll('.btn-modal').forEach((row) => row.addEventListener('click', (e) => {
        let obj = undefined;
        data.rows.forEach((row) => {
            if (row.art_id === e.target.dataset.art) {
                obj = row;
                return;
            }
        })
        response = obj;
        console.log(obj.art_id);
        document.querySelector('#art_id').value = obj.art_id
        document.querySelector("#artist_id").value = obj.artist_id;
        document.querySelector("#sub_category").value = obj.sub_category;
        document.querySelector("#base_price").value = obj.base_price;
        document.querySelector("#total_views").value = obj.total_views;
        document.querySelector("#likes").value = obj.likes;
        document.querySelector("#dislikes").value = obj.dislikes;
    }))
    // console.log(response);

    document.querySelector('.submit-btn').addEventListener('click', () => {
        console.log("Hello");
        console.log(data[0]);
        response.sub_category = document.querySelector('#sub_category').value;
        response.base_price = document.querySelector('#base_price').value;
        response.total_views = document.querySelector('#total_views').value;
        response.likes = document.querySelector('#likes').value;
        response.dislikes = document.querySelector('#dislikes').value;
        if (response.sub_category !== '' && response.base_price !== '' && response.total_views !== '' && response.likes !== '' && response.dislikes!=='') {
            fetch(`http://localhost:3000/artproducts/${response.art_id}`, {
                method: 'PUT',
                headers: {
                    'Content-type': 'application/json'
                },
                body: JSON.stringify(response)
            })
            if (!(alert(`Art ${response.art_id} updated successfully`))) {
                location.reload()
            }
        }
        else {
            alert("All fields must be non-empty!!");
        }
    })


    document.querySelectorAll('.btn-delete').forEach((row) => {
        row.addEventListener('click', (e) => {
            const id = e.target.dataset.art;
            console.log(id);
            if (confirm(`Are you sure you want to delete this art ${id}?`)) {
                fetch(`http://localhost:3000/artproducts/${id}`, {
                    method: "delete",
                    headers: {
                        'Content-type': "application/json"
                    }
                }).then((response) => {
                    console.log(response);
                    if (confirm(`Art ${id} deleted successfully`)) {
                        location.reload();
                    }
                })
            }
        })
    })
</script>

</html>